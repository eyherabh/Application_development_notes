#!/usr/bin/sed -Ef
:y
# No need to do anything if no '\r' is found
/\r/ {
h
s/^([^\r]*)\r+([^\r]*).*/\n\1\n\2/ 
:x
s/\n([^\n]{2,2})([^\n]*)\n([^\r]{2,2})/\3\n\2\n/ 
tx
s/\n([^\n])([^\n]*)\n([^\r])/\3\n\2\n/ 
s/\n// 
s/\n// 
x
s/^[^\r]*\r+[^\r]*// 
H
x
s/\n//
ty
}